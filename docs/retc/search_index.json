[["index.html", "Rのパッケージの活用 はじめに", " Rのパッケージの活用 Toshikazu Masumura 2023-04-10 はじめに "],["install.html", "Chap. 1 Rのインストール 1.1 ダウンロード 1.2 インストーラの起動 1.3 インストール完了", " Chap. 1 Rのインストール Rのインストール方法は，ネットでも多く掲載されている． ここでは，オプションの個人的な好みを強調しつつ説明する． 1.1 ダウンロード OSに合わせたインストーラをダウンロードする． Windowsの場合は，「Download R-4.x.x for Windows」(xはバージョンで異なる)をダウンロード． https://cran.r-project.org/bin/windows/base/ 1.2 インストーラの起動 ダウンロードしたファイルをクリック． 「…許可しますか?」に対して，「はい」を選択． インストール中に使用する言語 何でも大丈夫なので，好きなものを選ぶ． インストールの確認 「次へ」をクリック． インストール先のフォルダ そのままでOK．好みがあれば変更する． インストールするもの とりあえず，すべてチェックしておくくと良い． Message translationは，Rからのメッセージを日本語に翻訳するかどうか． チェックを入れないと，英語のみの表示． 結論としえは，とりあえずチェックを入れておき，必要に応じて英語で表示させるという方法が良いかもしれない． チェックを入れておくと，エラーメッセージなどを日本語で表示させることができる． 「そら日本語のほうが良いやん」と思うかもしれない． よくわからないエラーメッセージがしかも英語で表示されたら，わけがわからないからです． ただ，プログラミングの世界では，英語でのエラーメッセージのほうが便利なことが結構ある． それは，エラーメッセージをそのままネットで検索するときである． 日本語でのエラーメッセージだとネット上の情報が限られる． 一方，英語でのエラーメッセージで検索すると，原因や対処方法をかなりの確率で知ることができる． # https://cell-innovation.nig.ac.jp/SurfWiki/R_errormes_lang.html Sys.getenv(&quot;LANGUAGE&quot;) # 設定の確認 # 設定の変更方法 Sys.setenv(LANGUAGE=&quot;en&quot;) # 英語に変更 Sys.setenv(LANGUAGE=&quot;jp&quot;) # 日本語に変更 オプションの選択 とりあえず「Yes」を選択． 以下のオプションを選択するかどうか． ウィンドウの表示方法(MDI / SDI)の選択 個人的な好みはSDIですが，好みの問題ですので正直どちらでも大丈夫． MDI(左)は大きな1つのWindowの中に，コンソール(プログラムの入力部分)，グラフ，ヘルプなどが表示される． SDI(右)はコンソール，グラフ，ヘルプが別々のWindowとして表示される． どちらかといえば，自由度が高い． ヘルプの表示方法(Plain text / HTML help)の選択 個人的な好みはPlain textだが，好みの問題で正直どちらでも構わない． Plain textはテキストファイルで表示されるシンプルな作り． HTML helpはヘルプがブラウザ(GoogleChrome等)で表示される． 関連する関数などへのリンクが表示されるので，それらを参照するのは便利． その後の設定 その他は，既定値(そのまま)でOK． 1.3 インストール完了 インストールが完了すると，アイコンがデスクトップに表示される． アイコンをクリックすると，Rが起動する． "],["package.html", "Chap. 2 パッケージのインストール 2.1 CRANから 2.2 GitHubから", " Chap. 2 パッケージのインストール R単体でも多くの機能があるものの，実際には各種パッケージを利用することが多い． パッケージのインストールするには，Rで簡単なコマンドを実行するだけである． 2.1 CRANから CRANは，Rの総本山である． https://cran.r-project.org/ R本体だけでなく，各種パッケージが公開されている． https://cran.r-project.org/web/packages/available_packages_by_name.html CRANに掲載されており，パッケージの名前がわかっていたら，以下のようにすればインストールできる． # ミラーサイト(ダウンロード元)の設定 options(repos = &quot;https://cran.ism.ac.jp/&quot;) # 1つの場合 install.packages(&quot;tidyverse&quot;) # 複数の場合 pkg &lt;- c(&quot;xlsx&quot;, &quot;magrittr&quot;, &quot;devtools&quot;) install.packages(pkg) 実行すると，ファイルをダウンロードし，成功(あるいは失敗)したことが表示される． 2.2 GitHubから たいていはCRANに登録されているが，GitHubにしかないパッケージもある． その場合には，以下のようにする． install.packages(&quot;devtools&quot;) devtools::install_github(&quot;matutosi/ecan&quot;) "],["assoc.html", "Chap. 3 スクリプトの関連付け", " Chap. 3 スクリプトの関連付け Rのプログラムのファイルは拡張子「script.R」のように「R」という拡張子を付けて保存することが多い． 「.docx」をワードで，「.xlsx」をエクセルで開くのと同様に，私は「*．R」をテキストエディタで開くするように設定している． その後，開いたファイルをRのコンソールに貼り付けて，プログラムを実行する． このような使い方でもちろん良いのだが，内容を変更しないのであれば面倒臭い． つまり，ファイルをクリックするだけで，プログラムが実行されれば便利である． プログラムをRに関連付けれることで，これが実現できる． プログラムのファイル名を「.R」から「.scr」に変更する(「scr」は大文字小文字は関係なく，「Rsc」や「RSC」などでもOK)． 拡張子が表示されていない場合は，エクスプローラの表示のオプションで，「登録されている拡張子は表示しない」のチェックを外して(チェックしないで)，「OK」を選択してから，名前を変更する． ファイルを右クリックして，「プロパティ」を選択． 「全般」タブのやや上にあるプログラムの「変更」を選択． 「PCでアプリを選択する」をクリック． ファイル選択画面で，Rをインストールしたフォルダまで辿っていき(「c:\\Program files\\R\\R-4.2.3\\bin\\x64」など)，「Rscript.exe」を選択する． 「.rscファイルの既定のアプリを選択する」で「R for windows front-end」が表示されるので，「既定値を設定する」を選択． 全般タブのプログラムが「R for windows front-end」になっていることを確認して．「OK」を選択． ファイルのアイコンがRのアイコンになっていたらOK． ダブルクリックすると，ファイルの内容が実行される(はず)． "],["ggplot2.html", "Chap. 4 ggplot2の勧め 4.1 Rの作図環境の概要 4.2 ggplot2とは 4.3 ggplot2の利点 4.4 ggplot2の基本 4.5 facetを使おう 4.6 ggsave 4.7 文字化けへの対処(windows) 4.8 themeを少しだけ説明 4.9 shiny 4.10 参考書", " Chap. 4 ggplot2の勧め 4.1 Rの作図環境の概要 base(graphics) lattice grid ggplot2 4.2 ggplot2とは ggplot2は，tidy dataにしておけば，使いやすい 4.3 ggplot2の利点 1つのデータをもとに，ちょっとの変更で棒グラフ，散布図，などなど各種のplotが可能 図が綺麗で，テーマの変更も簡単 facetによるグループ分けも便利 magrittrとの相性も良い． 特にファイル名を設定するときの%$%や%T%など ggplot2をサポートするライブラリも豊富 凡例の自動的な位置決めや配置など ggpubrなども 4.4 ggplot2の基本 irisを例にするが，できれば，veganとかdaveのデータを使う tidy dataへの変換が必要 コードのみか，詳しくは松村や比嘉の解説を参考に gather()とspread()はpivot_longer()とpivot_wider()になって使いやすくなった． Hadley自身も使い方を混乱していたらしい aesthetics geom_point() geom_bar() aes() colour group size 4.5 facetを使おう forループやsubset，あるいはdplyr::filterを使っていたものが，一気にできて便利 コードも簡単で見やすい コードの転用が簡単 group VS facet 4.6 ggsave pngとPDF PDFで日本語文字が化ける場合は，pngを使う 指定しないと，直前のプロット 4.7 文字化けへの対処(windows) -cario? 4.8 themeを少しだけ説明 デフォルト theme_bw() 4.9 shiny Rだけでウェブアプリが作れる reactiveの考え方を覚える必要あり 4.10 参考書 ggplot2 ggplot2のレシピ unwin GDA チートシート "],["magrittr.html", "Chap. 5 magrritrの勧め 5.1 tidyverseとmagrittr 5.2 %&gt;%とその仲間 5.3 %&lt;&gt;% 5.4 %T&gt;% 5.5 %$%", " Chap. 5 magrritrの勧め 5.1 tidyverseとmagrittr tidyverseは，Rでのデータ解析には欠かせないものになっている． そこで，Rを起動時にtidyverseを読み込む人は多いだろう． なお，tidyverseは1つのライブラリではなく，複数のライブラリからなる． library(tidyverse) これらのライブラリの多く(forcats，tibble，stringr，dplyr，tidyr，purrr)で，%&gt;% (パイプ)を使うことができる． 私は%&gt;%がtidyverse独自のものだと勘違いをしていた． しかし，%&gt;%はもとはライブラリmagrittrの関数であり，そこからインポートされている． そのため，tidyverseを読み込むと使うことができる． %&gt;%は，慣れるまでは何が便利なのか分からないが，慣れると欠かせなくなる． さらに使っていると，癖なってしまって無駄にパイプを繋ぐこともある． 長過ぎるパイプは良くないのは当然であるものの，適度に使うとRでのプログラミングは非常に楽になる． tidyverseの関数では，引数とするオブジェクトが統一されている． 具体的には，第1引数のオブジェクトがデータフレームやtibbleになっていることが多い． そのため，パイプと相性が特に良い． 5.2 %&gt;%とその仲間 %&gt;%の仲間としては，以下の関数もある． %&lt;&gt;% %T&gt;% %$% これらの関数は，tidyverseには含まれていないため，使用するにはmagrittrを読み込む必要がある． library(magrittr) ## ## Attaching package: &#39;magrittr&#39; ## The following object is masked from &#39;package:purrr&#39;: ## ## set_names ## The following object is masked from &#39;package:tidyr&#39;: ## ## extract 5.3 %&lt;&gt;% 5.3.1 使い方 %&lt;&gt;%は，パイプを使って処理した内容を，最初のオブジェクトに再度代入するときに使う． ほんの少しだけ，コードを短くできる． mpg # 燃費データ ## # A tibble: 234 × 11 ## manufacturer model displ year cyl trans drv cty hwy fl class ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; ## 1 audi a4 1.8 1999 4 auto… f 18 29 p comp… ## 2 audi a4 1.8 1999 4 manu… f 21 29 p comp… ## 3 audi a4 2 2008 4 manu… f 20 31 p comp… ## 4 audi a4 2 2008 4 auto… f 21 30 p comp… ## 5 audi a4 2.8 1999 6 auto… f 16 26 p comp… ## 6 audi a4 2.8 1999 6 manu… f 18 26 p comp… ## 7 audi a4 3.1 2008 6 auto… f 18 27 p comp… ## 8 audi a4 quattro 1.8 1999 4 manu… 4 18 26 p comp… ## 9 audi a4 quattro 1.8 1999 4 auto… 4 16 25 p comp… ## 10 audi a4 quattro 2 2008 4 manu… 4 20 28 p comp… ## # … with 224 more rows tmp &lt;- mpg tmp &lt;- tmp %&gt;% dplyr::filter(year==1999) %&gt;% tidyr::separate(trans, into=c(&quot;trans1&quot;, &quot;trans2&quot;, NA)) %&gt;% print() ## # A tibble: 117 × 12 ## manufac…¹ model displ year cyl trans1 trans2 drv cty hwy fl class ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; ## 1 audi a4 1.8 1999 4 auto l5 f 18 29 p comp… ## 2 audi a4 1.8 1999 4 manual m5 f 21 29 p comp… ## 3 audi a4 2.8 1999 6 auto l5 f 16 26 p comp… ## 4 audi a4 2.8 1999 6 manual m5 f 18 26 p comp… ## 5 audi a4 q… 1.8 1999 4 manual m5 4 18 26 p comp… ## 6 audi a4 q… 1.8 1999 4 auto l5 4 16 25 p comp… ## 7 audi a4 q… 2.8 1999 6 auto l5 4 15 25 p comp… ## 8 audi a4 q… 2.8 1999 6 manual m5 4 17 25 p comp… ## 9 audi a6 q… 2.8 1999 6 auto l5 4 15 24 p mids… ## 10 chevrolet c150… 5.7 1999 8 auto l4 r 13 17 r suv ## # … with 107 more rows, and abbreviated variable name ¹​manufacturer tmp &lt;- mpg tmp %&lt;&gt;% dplyr::filter(year==1999) %&gt;% tidyr::separate(trans, into=c(&quot;trans1&quot;, &quot;trans2&quot;, NA)) %&gt;% print() ## # A tibble: 117 × 12 ## manufac…¹ model displ year cyl trans1 trans2 drv cty hwy fl class ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; ## 1 audi a4 1.8 1999 4 auto l5 f 18 29 p comp… ## 2 audi a4 1.8 1999 4 manual m5 f 21 29 p comp… ## 3 audi a4 2.8 1999 6 auto l5 f 16 26 p comp… ## 4 audi a4 2.8 1999 6 manual m5 f 18 26 p comp… ## 5 audi a4 q… 1.8 1999 4 manual m5 4 18 26 p comp… ## 6 audi a4 q… 1.8 1999 4 auto l5 4 16 25 p comp… ## 7 audi a4 q… 2.8 1999 6 auto l5 4 15 25 p comp… ## 8 audi a4 q… 2.8 1999 6 manual m5 4 17 25 p comp… ## 9 audi a6 q… 2.8 1999 6 auto l5 4 15 24 p mids… ## 10 chevrolet c150… 5.7 1999 8 auto l4 r 13 17 r suv ## # … with 107 more rows, and abbreviated variable name ¹​manufacturer 5.3.2 注意点 試行錯誤でコードを書いている途中は，あまり使わないほうが良いだろう． もとのオブジェクトが置き換わるので，処理結果が求めるものでないときに，もとに戻れないためである． 5.4 %T&gt;% 5.4.1 使い方 処理途中に分岐をして別の処理をさせたいときに使う． ちょっとだけ処理して，変数に保存するとき imapと組み合わせると便利かも 画像を保存するファイル名の設定とか mpg # 燃費データ ## # A tibble: 234 × 11 ## manufacturer model displ year cyl trans drv cty hwy fl class ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; ## 1 audi a4 1.8 1999 4 auto… f 18 29 p comp… ## 2 audi a4 1.8 1999 4 manu… f 21 29 p comp… ## 3 audi a4 2 2008 4 manu… f 20 31 p comp… ## 4 audi a4 2 2008 4 auto… f 21 30 p comp… ## 5 audi a4 2.8 1999 6 auto… f 16 26 p comp… ## 6 audi a4 2.8 1999 6 manu… f 18 26 p comp… ## 7 audi a4 3.1 2008 6 auto… f 18 27 p comp… ## 8 audi a4 quattro 1.8 1999 4 manu… 4 18 26 p comp… ## 9 audi a4 quattro 1.8 1999 4 auto… 4 16 25 p comp… ## 10 audi a4 quattro 2 2008 4 manu… 4 20 28 p comp… ## # … with 224 more rows 5.4.2 注意点 分岐途中の結果をオブジェクトに代入するときには，&lt;-ではなく，&lt;&lt;-を使用する． 明示的に「.」を使う 複数処理があれば，「{}」で囲う 処理終了後に「%&gt;%」が必要 例のコードを示す # mpg %T&gt;% # { # tmp &lt;&lt;- dplyr::select(., ) # } %&gt;% 5.5 %$% 5.5.1 使い方 mpg %&gt;% .$manufacturer ## [1] &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; ## [6] &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; ## [11] &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; ## [16] &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; ## [21] &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; ## [26] &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; ## [31] &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; ## [36] &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; ## [41] &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; ## [46] &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; ## [51] &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; ## [56] &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; ## [61] &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; ## [66] &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; ## [71] &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;ford&quot; ## [76] &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; ## [81] &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; ## [86] &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; ## [91] &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; ## [96] &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;honda&quot; ## [101] &quot;honda&quot; &quot;honda&quot; &quot;honda&quot; &quot;honda&quot; &quot;honda&quot; ## [106] &quot;honda&quot; &quot;honda&quot; &quot;honda&quot; &quot;hyundai&quot; &quot;hyundai&quot; ## [111] &quot;hyundai&quot; &quot;hyundai&quot; &quot;hyundai&quot; &quot;hyundai&quot; &quot;hyundai&quot; ## [116] &quot;hyundai&quot; &quot;hyundai&quot; &quot;hyundai&quot; &quot;hyundai&quot; &quot;hyundai&quot; ## [121] &quot;hyundai&quot; &quot;hyundai&quot; &quot;jeep&quot; &quot;jeep&quot; &quot;jeep&quot; ## [126] &quot;jeep&quot; &quot;jeep&quot; &quot;jeep&quot; &quot;jeep&quot; &quot;jeep&quot; ## [131] &quot;land rover&quot; &quot;land rover&quot; &quot;land rover&quot; &quot;land rover&quot; &quot;lincoln&quot; ## [136] &quot;lincoln&quot; &quot;lincoln&quot; &quot;mercury&quot; &quot;mercury&quot; &quot;mercury&quot; ## [141] &quot;mercury&quot; &quot;nissan&quot; &quot;nissan&quot; &quot;nissan&quot; &quot;nissan&quot; ## [146] &quot;nissan&quot; &quot;nissan&quot; &quot;nissan&quot; &quot;nissan&quot; &quot;nissan&quot; ## [151] &quot;nissan&quot; &quot;nissan&quot; &quot;nissan&quot; &quot;nissan&quot; &quot;pontiac&quot; ## [156] &quot;pontiac&quot; &quot;pontiac&quot; &quot;pontiac&quot; &quot;pontiac&quot; &quot;subaru&quot; ## [161] &quot;subaru&quot; &quot;subaru&quot; &quot;subaru&quot; &quot;subaru&quot; &quot;subaru&quot; ## [166] &quot;subaru&quot; &quot;subaru&quot; &quot;subaru&quot; &quot;subaru&quot; &quot;subaru&quot; ## [171] &quot;subaru&quot; &quot;subaru&quot; &quot;subaru&quot; &quot;toyota&quot; &quot;toyota&quot; ## [176] &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; ## [181] &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; ## [186] &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; ## [191] &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; ## [196] &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; ## [201] &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; ## [206] &quot;toyota&quot; &quot;toyota&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; ## [211] &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; ## [216] &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; ## [221] &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; ## [226] &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; ## [231] &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; mpg %$% manufacturer ## [1] &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; ## [6] &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; ## [11] &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; ## [16] &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; ## [21] &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; ## [26] &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; ## [31] &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;chevrolet&quot; ## [36] &quot;chevrolet&quot; &quot;chevrolet&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; ## [41] &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; ## [46] &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; ## [51] &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; ## [56] &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; ## [61] &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; ## [66] &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; ## [71] &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;dodge&quot; &quot;ford&quot; ## [76] &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; ## [81] &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; ## [86] &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; ## [91] &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; ## [96] &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;ford&quot; &quot;honda&quot; ## [101] &quot;honda&quot; &quot;honda&quot; &quot;honda&quot; &quot;honda&quot; &quot;honda&quot; ## [106] &quot;honda&quot; &quot;honda&quot; &quot;honda&quot; &quot;hyundai&quot; &quot;hyundai&quot; ## [111] &quot;hyundai&quot; &quot;hyundai&quot; &quot;hyundai&quot; &quot;hyundai&quot; &quot;hyundai&quot; ## [116] &quot;hyundai&quot; &quot;hyundai&quot; &quot;hyundai&quot; &quot;hyundai&quot; &quot;hyundai&quot; ## [121] &quot;hyundai&quot; &quot;hyundai&quot; &quot;jeep&quot; &quot;jeep&quot; &quot;jeep&quot; ## [126] &quot;jeep&quot; &quot;jeep&quot; &quot;jeep&quot; &quot;jeep&quot; &quot;jeep&quot; ## [131] &quot;land rover&quot; &quot;land rover&quot; &quot;land rover&quot; &quot;land rover&quot; &quot;lincoln&quot; ## [136] &quot;lincoln&quot; &quot;lincoln&quot; &quot;mercury&quot; &quot;mercury&quot; &quot;mercury&quot; ## [141] &quot;mercury&quot; &quot;nissan&quot; &quot;nissan&quot; &quot;nissan&quot; &quot;nissan&quot; ## [146] &quot;nissan&quot; &quot;nissan&quot; &quot;nissan&quot; &quot;nissan&quot; &quot;nissan&quot; ## [151] &quot;nissan&quot; &quot;nissan&quot; &quot;nissan&quot; &quot;nissan&quot; &quot;pontiac&quot; ## [156] &quot;pontiac&quot; &quot;pontiac&quot; &quot;pontiac&quot; &quot;pontiac&quot; &quot;subaru&quot; ## [161] &quot;subaru&quot; &quot;subaru&quot; &quot;subaru&quot; &quot;subaru&quot; &quot;subaru&quot; ## [166] &quot;subaru&quot; &quot;subaru&quot; &quot;subaru&quot; &quot;subaru&quot; &quot;subaru&quot; ## [171] &quot;subaru&quot; &quot;subaru&quot; &quot;subaru&quot; &quot;toyota&quot; &quot;toyota&quot; ## [176] &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; ## [181] &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; ## [186] &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; ## [191] &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; ## [196] &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; ## [201] &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; &quot;toyota&quot; ## [206] &quot;toyota&quot; &quot;toyota&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; ## [211] &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; ## [216] &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; ## [221] &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; ## [226] &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; ## [231] &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; &quot;volkswagen&quot; 5.5.2 注意点 "],["rvest.html", "Chap. 6 rvestでスクレイピング 6.1 スクレイピング 6.2 rvest と RSelenium 6.3 rvestのできること 6.4 準備 6.5 HTMLの取得 6.6 DOMの取得", " Chap. 6 rvestでスクレイピング 6.1 スクレイピング ここでのスクレイピングとは，ウェブスクレイピングの省略のことで，ウェブサイトにある情報を収集することである． ウェブサイトから植生調査データを収集することはほとんどないものの，関連データの収集は可能である． 例えば，気象庁のページから気象データが収集可能である． もちろん，気象データは手動でも収集可能ではあるが，多大な手間と長い時間が必要である． 研究に必要なデータを自動で取得できれば，手間と時間の節約が可能である． そこで，本稿ではウェブでの情報収集の方法を紹介することを目的とする． 世界の各地点の気象データをプロット 情報収集にはRのパッケージであるrvestを用いる． rvestを用いて気象庁のページから世界の気象データを入手して，気候ダイアグラムを描画する． Rのパッケージ作成では，rvestを用いて作成した関数と収集したデータをまとめたパッケージの作成方法を紹介する． 著者自身，他人のためにパッケージをつくることは考えておらず，基本的には自分の研究や作業のための関数をまとめることを目的としてパッケージをいくつか作成した． 作成したら，ついでに他人にも使ってもらえれば嬉しいという程度である． 過去に作成した関数は，しばらくすると関数の引数や返り値がどのようなものであったのか忘れてしまいがちである． パッケージをつくる(特にCRANに登録する)には，引数，返り値，使用例などをまとめる必要がある． きっちりまとめなくても良いのではあるが，決まった形式の方がむしろまとめやすい． また，RStudioとusethis, testthat, devtoolsなどのパッケージを使ってパッケージ開発すると，各種チェックやテストが可能である． 各種チェックやテストでたくさんのエラーを見ると，チェックやテストは正直なところ煩わしいと感じる． 特に，パケージ開発に慣れていないと特にそうである． しかし，チェックやテストをすることで，関数の完成度を確実に高めることができるため，パッケージとしてまとめる利点である． 6.2 rvest と RSelenium スクレイピングをするために使われる主なRのパッケージとしては，rvestとRSeleniumがある． rvestは，静的なサイトを対象とするときに役立つ． つまり，URLを指定すれば対象のサイトのページが決まるときである． 気象庁での気象データを提供しているページがこれに当たる． 一方，RSeleniumは動的なサイトを対象とするときに役立つ． 例えば，テキストボックスへのデータ入力やプルダウンメニューの選択あるいはその後のマウス操作でページが遷移する場合である． このような動的なサイトでは，Seleniumだけでなく，Javascriptを部分的に用いるのも効果的である． なお，rvestでもユーザ名とパスワードを用いた一般的なログインは可能である． また，politeパッケージと組み合わせることである程度の動的なサイトのスクレイピングは可能である． 6.3 rvestのできること HTMLの取得 DOMの取得: id, class, tagNameなどを用いる tableの取得 HTML内の取得したいデータはtableにあることが多いため，非常に便利 そもそも，tableでないデータを取得するのは非常に不便 リンクの取得 ページ遷移に使用する stringrと組み合わせて使うと良い 文字コードの変換にはstringiを用いる tidyverseやmagrittrとの合せ技が便利 Formの入力・選択 radioボタンはちょっと工夫が必要 moranajp::html_radio_set() 無理やりな感じではあるが，同一名称のradioボタンを全て同じ値に変更する 本来なら，不要なradioボタンのフォームを削除 可能だが，インデクスがずれるので結構厄介 politeパッケージとの連携 6.4 準備 # install.packages(&quot;rvest&quot;) # library(rvest) 6.5 HTMLの取得 6.5.1 使い方 6.5.2 注意点 6.6 DOMの取得 6.6.1 使い方 6.6.2 注意点 "],["rselenium.html", "Chap. 7 Rselenium 7.1 準備 7.2 ブラウザの自動化 7.3 7.4 要素の取得 7.5 その他", " Chap. 7 Rselenium Seleniumは，ブラウザを使って動的に巡回しつつ，スクレイピングをするのに適している． JavascriptやPHPなどを使って，動的に作成されるサイトでは，URLだけではページを特定することはできない． そのため，rvestだけではデータを取得するのが困難である． 7.1 準備 RSelenium: CRANからインストール Selenium: 本家サイトからインストール 注意: ver3.xxx をインストールする ver4.0 以上はRSeleniumuが対応していない(Pythonなら可) ChromeDriver 注意: 自身の利用しているブラウザのドライバが必要(バージョンも合致する必要あり) GoogleChromeは自動的にupdateされるので，バージョンをよく確認する 通常は，安定版の最新版で大丈夫である Seleniumと同じフォルダに保存する 7.2 ブラウザの自動化 7.3 7.3.1 使い方 7.3.2 注意点 7.4 要素の取得 idがわかるとき document.getElementByID() xpath document.selectQueryAll()[] 動的にサイトが作られているときには，変化する可能性があるので注意 使用されているJavaScriptの関数がわかる script &lt;- “” rem$excute(script) 例 BiSSの文字サイズの変更 主命リストの列数の変更 スクレイピングの実行時には，適切な時間間隔を空ける - 通常は5秒以上を求めていることが多い ページ遷移の命令を送信後，十分な間隔がないとHTMLの要素を取得しきれていないことがある 極端な場合，サーバーからの情報がほとんど何も送られていない，つまりページの内容がほとんど何もないことにある． この状況は，通常のマウス操作では何も表示されていないところをクリックするのと同じ状態である． サーバからの情報を待つ意味でも適度な間隔を空けるのが望ましい 動的なサイトの場合は，HTMLの構成中の可能性もある ログイン等のページでも，遷移途中のことがある． 7.5 その他 Rからシェルのコマンドを使う pngからPDFへ変換 ファイルの移動 Seleniumuの起動・終了 MeCabやGINZAの実行 "],["shell.html", "Chap. 8 shell 8.1 準備", " Chap. 8 shell Rからシェルのコマンドを使う ファイルの移動 PDFファイルの結合 pngからPDFへ変換 手作業でも良いが，ファイル数が多かったり，作業回数が多かったりするなら，自動化するのが便利である． 例えば，ファイルの操作やちょっとしたCUIアプリをコマンドでの動作をRでやってしまおうという邪道中の邪道である． 上記の操作をする際は，LinuxやMacであればshellスクリプトとして，Windowsであればバッチファイルとしてコードを書くのが本来の方法である． しかし，shellスクリプトやバッチファイルのコマンドを体系的に勉強したことはない(その意味ではRの勉強もかなり怪しい)． ウェブの情報をもとにしつつ，なんとなくコードを書いたことはある． とはいえ変数の使い方などは特によくわからないので，ちょっとした操作にも時間がかかりそう． そこで，慣れたRを使って雑多な操作をやっつけてしまおうと考えた． 以下のような操作を自動化する． ・複数のフォルダに入ったPDFファイルを1つのPDFに結合 ・結合後のファイルを指定場所に移動 ・元ファイルを削除 なお，以下は基本的にwindowsでの操作を前提としているが，LinuxやMacでも同じあるいは類似のコマンドで代用できる可能性が高い． 日本語文字が入っていると，操作に若干手間がかかることが多い． dosコマンド ls, dir ファイル，ディレクトリの一覧を取得 move, copy, remove, rename ファイルの移動，コピー，削除, リネーム cd ディレクトリの移動 Rの関数 shell(), system() コマンドの実行 setwd() ワーキングディレクトリの設定 ディレクトリ名にスペースや日本語が入っていて，cdコマンドがうまくいかないときは，こっちのほうが便利 paste0() 文字列の結合 stringrの関数 stringiの関数 多くの関数はstringrにラッパーがあるが，文字コードの変換などはstringiの関数が必要 日本語文字を使わなければ不要 ファイル名の命名規則を決めておき，お世話にならない方が幸せ purrr::map() for loopの代わり # ファイル名を取得する関数など その他ツール concatPDF PDFの結合など(win10 OK，win11 NG) # ConcatPDF /outfile Merged.pdf File1.pdf File2.pdf File3.pdf pdftk PDFの結合など(win11 OK) pdftk File1.pdf File2.pdf File3.pdf cat output Merged.pdf ImageMagick 画像変換など 8.1 準備 "],["dbi.html", "Chap. 9 DBIでデータ取得 9.1 データベースとの連携 9.2 DBIでできること 9.3 準備 9.4 使い方", " Chap. 9 DBIでデータ取得 9.1 データベースとの連携 リレーショナル・データベースと接続してデータを取得するためのパッケージには色々とある． CRAN Task View: Databases with R には多くのパッケージが掲載されている． https://cran.r-project.org/web/views/Databases.html どれを使っても良いが，よく使われているのはDBIのようだ． https://cran.r-project.org/web/packages/DBI/index.html 9.2 DBIでできること 各種データベースとの接続 SQLによるデータ操作 SQLを使い慣れていれば，SQLで各種の操作をするのが良いだろう． 一方，Rでのデータフレームの操作に慣れていれば，取得したデータをRで操作するのが良い． つまり，データ取得だけにDBIを利用して，その後はdplyrやtidyverseの各種パッケージの関数を駆使してデータを処理する． さらに，その結果を図示したい場合は，ggplot2を使うと良い． 9.3 準備 install.packages(&quot;DBI&quot;) library(DBI) 9.4 使い方 詳細は以下を参照． https://cran.r-project.org/web/packages/DBI/vignettes/DBI-1.html "],["xlsx.html", "Chap. 10 xlsxでエクセル操作 10.1 オートフィルタの設定とウィンドウ枠の固定の自動化スクリプト 10.2 その他の操作(未作成)", " Chap. 10 xlsxでエクセル操作 xlsxパッケージを使うと，エクセルのファイルの読み込み・書き込みをはじめ， オートフィルタの設定やウィンドウ枠の固定などの各種操作が可能である． 10.1 オートフィルタの設定とウィンドウ枠の固定の自動化スクリプト xlsxの使用例として，オートフィルタを設定して・ウィンドウ枠を固定する自動化スクリプトを作成した． 10.1.1 使用方法 準備：Rのインストール set_autofilter_freezepanel.rsc をダウンロードして，任意のフォルダに保存． set_autofilter_freezepanel.rsc と同じフォルダに，処理したいエクセルのファイルを保存． 実行前のエクセルのファイル スクリプトの関連付けを参考にして，「.rsc」を「Rscript.exe」に関連付けする(Windowsの場合)．Macの場合は，Mac - 拡張子に関連付けられているアプリを変更する方法などを参考にしてほしい． set_autofilter_freezepanel.rsc をダブルクリックして実行すると，黒い画面が表示されてプログラムが実行される． プログラムが自動的にエクセルのファイルの1行目のA列からZ列までにオートフィルタを設定し，1行目と1列目でウィンドウ枠を固定する． 複数ファイル・複数シートにも対応している． なお，初回実行時は，xlsxパケージのダウンロードのため，少し時間がかかるかもしれない． 2回目以降はファイル数が多すぎなければ，一瞬で処理されるはず． 実行後のエクセルのファイル 10.1.2 スクリプトの内容説明 # Package, 準備 if(! &quot;xlsx&quot; %in% installed.packages()[,1]){ # xlsxパッケージ有無の確認 # パッケージが無い場合 options(repos = &quot;https://cran.ism.ac.jp/&quot;) # ミラーサイトの設定 install.packages(&quot;xlsx&quot;) # パッケージのインストール } # Functions, 関数 set_auto_filter &lt;- function(sh){ # A1からZ1までにオートフィルタを設定 # もっと多くの列で設定したければ，&quot;A1:Z1&quot;のところを修正する xlsx::addAutoFilter(sh, &quot;A1:Z1&quot;) } set_freeze_panel &lt;- function(sh){ # 1列目と1行目のウィンドウ枠を固定 # 固定する場所の変更方法 # 2行目までを固定したい場合は，引数の2つ目と4つ目を，3にする # 3列目までを固定したい場合は，引数の3つ目と5つ目を，4にする xlsx::createFreezePane(sh, 2, 2, 2, 2) } set_af_fp &lt;- function(file){ wb &lt;- xlsx::loadWorkbook(file) # ワークブックの読み込み for(sh in xlsx::getSheets(wb)){ # シートの数だけ繰り返し set_auto_filter(sh) # オートフィルタの設定 set_freeze_panel(sh) # ウィンドウ枠の固定 } xlsx::saveWorkbook(wb, file) # ワークブクの保存 } # Main, 本体 files &lt;- list.files(pattern = &quot;xls&quot;) # &quot;.xls&quot;と&quot;xlsx&quot;の一覧取得 for(file in files){ # ファイルの数だけ繰り返し set_af_fp(file) # set_af_fp()の実行 } 10.2 その他の操作(未作成) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
